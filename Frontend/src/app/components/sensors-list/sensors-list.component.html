<app-page-layout title="Danh s√°ch d·ªØ li·ªáu c·∫£m bi·∫øn">
  <div class="page">

  <div class="controls">
    <div class="row">
      <label>
        C·ªôt t√¨m ki·∫øm
        <select [(ngModel)]="column">
          <option value="time">time</option>
          <option value="id">id</option>
          <option value="heartRate">heartRate</option>
          <option value="SPO2">SPO2</option>
          <option value="bodyTemperature">bodyTemperature</option>
        </select>
      </label>
      
      <label>
        Gi√° tr·ªã t√¨m ki·∫øm
        <input 
          *ngIf="column !== 'time'" 
          type="number" 
          [(ngModel)]="searchValue" 
        />
        <input 
          *ngIf="column === 'time'" 
          type="text" 
          [(ngModel)]="searchValue" 
        />
      </label>
      
      <button (click)="search()">T√¨m</button>
      <button (click)="resetSearchAndReload()">Reset</button>
    </div>
  </div>

  <div class="error" *ngIf="errorMessage">{{ errorMessage }}</div>

  <div class="table-wrapper" *ngIf="!loading; else loadingTpl">
    <table>
      <thead>
        <tr>
          <th>
            ID
            <button class="sort-btn" (click)="sortByColumn('id')">
              <span *ngIf="sortBy === 'id'">{{ sortDir === 'asc' ? '‚ñ≤' : '‚ñº' }}</span>
              <span *ngIf="sortBy !== 'id'">‚ñº</span>
            </button>
          </th>
          <th>
            BODY TEMPERATURE
            <button class="sort-btn" (click)="sortByColumn('bodyTemperature')">
              <span *ngIf="sortBy === 'bodyTemperature'">{{ sortDir === 'asc' ? '‚ñ≤' : '‚ñº' }}</span>
              <span *ngIf="sortBy !== 'bodyTemperature'">‚ñº</span>
            </button>
          </th>
          <th>
            HEART BEAT
            <button class="sort-btn" (click)="sortByColumn('heartRate')">
              <span *ngIf="sortBy === 'heartRate'">{{ sortDir === 'asc' ? '‚ñ≤' : '‚ñº' }}</span>
              <span *ngIf="sortBy !== 'heartRate'">‚ñº</span>
            </button>
          </th>
          <th>
            SPO2
            <button class="sort-btn" (click)="sortByColumn('SPO2')">
              <span *ngIf="sortBy === 'SPO2'">{{ sortDir === 'asc' ? '‚ñ≤' : '‚ñº' }}</span>
              <span *ngIf="sortBy !== 'SPO2'">‚ñº</span>
            </button>
          </th>
          <th>
            TIME
            <button class="sort-btn" (click)="sortByColumn('time')">
              <span *ngIf="sortBy === 'time'">{{ sortDir === 'asc' ? '‚ñ≤' : '‚ñº' }}</span>
              <span *ngIf="sortBy !== 'time'">‚ñº</span>
            </button>
          </th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let r of rows">
          <td>{{ r.id }}</td>
          <td>{{ r.bodyTemperature }}¬∞C</td>
          <td>{{ r.heartRate }}</td>
          <td>{{ r.spo2 ?? r.sPO2 }}%</td>
          <td class="time-cell">
            {{ r.time | date:'yyyy-MM-dd HH:mm:ss' }}
            <button class="copy-btn" (click)="copyToClipboard(r.time)" title="Copy th·ªùi gian">
              üìã
            </button>
          </td>
        </tr>
        <tr *ngIf="rows.length === 0">
          <td colspan="5" style="text-align:center">Kh√¥ng c√≥ d·ªØ li·ªáu</td>
        </tr>
      </tbody>
    </table>
  </div>

  <ng-template #loadingTpl>
    <div>ƒêang t·∫£i...</div>
  </ng-template>

  <div class="pagination" *ngIf="totalPages > 0">
    <button [disabled]="page === 0" (click)="goToPage(0)">¬´</button>
    <button [disabled]="page === 0" (click)="goToPage(page - 1)">‚Äπ</button>
    <span>Trang {{ page + 1 }} / {{ totalPages }}</span>
    <button [disabled]="page >= totalPages - 1" (click)="goToPage(page + 1)">‚Ä∫</button>
    <button [disabled]="page >= totalPages - 1" (click)="goToPage(totalPages - 1)">¬ª</button>
    
    <label class="page-size-selector">
      S·ªë b·∫£n ghi m·ªói trang:
      <select [(ngModel)]="size" (change)="changePageSize(size)">
        <option value="5">5</option>
        <option value="10">10</option>
        <option value="20">20</option>
        <option value="50">50</option>
        <option value="100">100</option>
      </select>
    </label>
  </div>
  </div>
</app-page-layout>
